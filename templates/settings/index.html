<!DOCTYPE html>
<html>
<head>
  <title>Settings Page</title>
</head>
<body>
  <h1>Settings Page</h1>

  <div id="settingsContainer">
    <!-- Settings will be dynamically generated here -->
  </div>

  <button onclick="saveSettings()">Save Settings</button>

  <script>
    // Simulated list of DAC addresses
    const dac_addresses = dac_addresses;
    console.prinSt(dac_addresses);
    // Create settings based on the list of DAC addresses
    const settings = dac_addresses.map(address => ({ address: address, channel:0, name: ''  }));

    function createSettingElement(setting) {
      const div = document.createElement('div');
      div.innerHTML = `
        <label>${setting.name}</label>
        <input type="text" id="${setting.name.replace(/\s+/g, '_').toLowerCase()}" value="${setting.value}">
        <br>
      `;
      return div;
    }

    function populateSettings() {
      const settingsContainer = document.getElementById('settingsContainer');
      settings.forEach(setting => {
        const settingElement = createSettingElement(setting);
        settingsContainer.appendChild(settingElement);
      });
    }

    function saveSettings() {
      const data = {};
      settings.forEach(setting => {
        const settingValue = document.getElementById(setting.name.replace(/\s+/g, '_').toLowerCase()).value;
        data[setting.name] = settingValue;
      });

      const jsonContent = JSON.stringify(data, null, 2);

      // Save JSON content to a file (e.g., using Blob)
      const blob = new Blob([jsonContent], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'settings.json';
      a.click();
    }

    // Check if settings file exists and populate settings accordingly
    fetch('settings.json')
      .then(response => {
        if (response.ok) {
          return response.json();
        }
        throw new Error('Settings file not found');
      })
      .then(data => {
        settings.forEach(setting => {
          if (data.hasOwnProperty(setting.name)) {
            const settingValue = data[setting.name];
            document.getElementById(setting.name.replace(/\s+/g, '_').toLowerCase()).value = settingValue;
          }
        });
      })
      .catch(error => {
        console.error(error);
        // Handle file not found or other errors
      });

    populateSettings();
  </script>
</body>
</html>

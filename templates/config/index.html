<!DOCTYPE html>
<html>
<head>
    <title>Edit Settings</title>
    <style>
        label {
            display: block;
            margin-top: 10px;
        }
    </style>

    
</head>
<body>
    <h1>Edit Settings</h1>
    <form id="settingsForm">
        <h2>DAC Settings</h2>
        <div id="dacSettings"></div>
        <h2>Relay Settings</h2>
        <div id="relaySettings"></div>
        <button type="submit">Save</button>
    </form>

    <script>
    // Function to generate input fields based on detected DAC addresses
    function generateInputs(section, addresses) {
        const container = document.getElementById(section + 'Settings');
        addresses.forEach((address, index) => {
            const div = document.createElement('div');
            div.innerHTML = `<label>Address: ${address}</label>`;  // Non-editable address field

            // Search for matching DAC configuration from JSON using address
            fetch('/config')
                .then(response => response.json())
                .then(jsonData => {
                    const matchedConfig = jsonData.dac.find(config => config.address === address);
                    if (matchedConfig) {
                        // Fill fields from JSON if a match is found
                        const name = matchedConfig.name || '';
                        const channel = matchedConfig.channel || 0;

                        const nameLabel = document.createElement('label');
                        nameLabel.textContent = 'Name:';
                        const nameInput = document.createElement('input');
                        nameInput.setAttribute('type', 'text');
                        nameInput.setAttribute('name', `${section}[${index}][name]`);
                        nameInput.setAttribute('value', name);
                        div.appendChild(nameLabel);
                        div.appendChild(nameInput);

                        const channelLabel = document.createElement('label');
                        channelLabel.textContent = 'Channel (0 or 1):';
                        const channelInput = document.createElement('input');
                        channelInput.setAttribute('type', 'number');
                        channelInput.setAttribute('name', `${section}[${index}][channel]`);
                        channelInput.setAttribute('value', channel);
                        channelInput.setAttribute('min', '0');
                        channelInput.setAttribute('max', '1');
                        div.appendChild(channelLabel);
                        div.appendChild(channelInput);
                    } else {
                        // If no match found, create blank fields
                        const nameInput = document.createElement('input');
                        nameInput.setAttribute('type', 'text');
                        nameInput.setAttribute('name', `${section}[${index}][name]`);
                        div.appendChild(nameInput);

                        const channelInput = document.createElement('input');
                        channelInput.setAttribute('type', 'number');
                        channelInput.setAttribute('name', `${section}[${index}][channel]`);
                        channelInput.setAttribute('value', '0'); // Default to 0
                        channelInput.setAttribute('min', '0');
                        channelInput.setAttribute('max', '1');
                        div.appendChild(channelInput);
                    }
                    container.appendChild(div);
                })
                .catch(error => {
                    console.error('Error fetching JSON:', error);
                });
        });
    }

    // Generate inputs for DAC settings using the detected addresses
    generateInputs('dac', detectedAddresses);

    </script>
</body>
</html>

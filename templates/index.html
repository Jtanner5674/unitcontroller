<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DAC Control</title>
    <script>
        // Function to handle form submissions asynchronously
        function submitForm(event, url) {
        console.log('Form submitted:', url, event);
        event.preventDefault(); // Prevent default form submission behavior
        let formData = new FormData(event.target);
        console.log(formData); // Move this statement here
        fetch(url, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            // Handle the response from the Flask server if needed
            console.log('Form submitted successfully!');
        })
        .catch(error => {
            // Handle any errors that occurred during the fetch
            console.error('Error submitting form:', error);
        });
    }

    </script>
</head>
<body>
    <h1>DAC Control Interface</h1>

    {% for dac_id, dac in dac_objects.items() %}
        <!-- Form to set voltage for Channel 1 -->
        <form onsubmit="submitForm(event, '/set_voltage{{ dac_id }}')" method="post">
            <label for="voltage1_{{ dac_id }}">Enter voltage for Channel 1 (0-100%):</label>
            <input type="range" id="voltage1_{{ dac_id }}" name="voltage1" min="0" max="100" step=".1">
            <button type="submit">Set Voltage for Channel 1 on DAC {{ dac_id }}</button>
        </form>

        <!-- Form to set voltage for Channel 2 -->
        <form onsubmit="submitForm(event, '/set_voltage2{{ dac_id }}')" method="post">
            <label for="voltage2_{{ dac_id }}">Enter voltage for Channel 2 (0-100%):</label>
            <input type="range" id="voltage2_{{ dac_id }}" name="voltage2" min="0" max="100" step=".1">
            <button type="submit">Set Voltage for Channel 2 on DAC {{ dac_id }}</button>
        </form>
        
        <!-- open and closing the channelsimport json

# Assuming your JSON data with IDs represented as hexadecimal strings
data = {
    "dac": [
        {"name": "existing_dac_1", "id": "0x10"},
        {"name": "existing_dac_2", "id": "0x20"},
        {"name": "new_dac", "id": "0x60"}
    ],
    "relay": [
        {"name": "relay_1", "id": "0x30"},
        {"name": "relay_2", "id": "0x40"}
    ]
}

# Write JSON data to a config file
with open('config.json', 'w') as file:
    json.dump(data, file, indent=2) -->
        <a href="#" onclick="sendPostRequest('/close1{{ dac_id }}')">Close Channel 1 on DAC {{ dac_id }}</a>
        <a href="#" onclick="sendPostRequest('/close2{{ dac_id }}')">Close Channel 2 on DAC {{ dac_id }}</a>
        <a href="#" onclick="sendPostRequest('/open1{{ dac_id }}')">Open Channel 1 on DAC {{ dac_id }}</a>
        <a href="#" onclick="sendPostRequest('/open2{{ dac_id }}')">Open Channel 2 on DAC {{ dac_id }}</a>
        
        
        <script>
            function sendPostRequest(url) {
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({}) // Add any payload if required
                })
                .then(response => {
                    // Handle the response as needed
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        </script>

    {% endfor %}
</body>
</html>

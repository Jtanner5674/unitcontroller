<!DOCTYPE html>
<html>
<head>
    <title>DAC Control</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            function updateSliderValue(channel, value) {
                const slider = document.getElementById(`voltage${channel}`);
                const textInput = document.getElementById(`voltage${channel}_text`);
                slider.value = value;
                textInput.value = value;
            }

            function updateTextInput(channel, value) {
                const slider = document.getElementById(`voltage${channel}`);
                const textInput = document.getElementById(`voltage${channel}_text`);
                textInput.value = value;
                slider.value = value;
            }

            function getCurrentVoltages() {
                $.ajax({
                    url: '/get_current_voltages',
                    type: 'GET',
                    success: function(data) {
                        updateTextInput(1, data.voltage1);
                        updateSliderValue(1, data.voltage1);
                        updateTextInput(2, data.voltage2);
                        updateSliderValue(2, data.voltage2);
                    }
                });
            }

            // Fetch current voltages on page load
            getCurrentVoltages();

            $('input[type="range"]').on('input', function() {
                let channel = $(this).attr('data-channel');
                let value = $(this).val();
                $(`#voltage${channel}_text`).val(value);
            });

            $('input[type="number"]').on('input', function() {
                let channel = $(this).attr('data-channel');
                let value = $(this).val();
                $(`#voltage${channel}`).val(value);
            });
        });
    </script>
</head>
<body>
    <h1>Testing DAC Control Interface</h1>
    
    <form action="/set_voltage1" method="post">
        <label for="voltage1">Valve 1:</label>
        <input type="range" id="voltage1" name="voltage1" min="0" max="100" step="1" value="0" data-channel="1"><br><br>
        <input type="number" id="voltage1_text" name="voltage1_text" min="0" max="100" step="1" value="0" data-channel="1">
        <input type="submit" value="Set Channel 1">
    </form>

    <a href="/closed1"><button>Close</button></a>
    <a href="/open1"><button>Open</button></a>
    
    <br>
    
    <form action="/set_voltage2" method="post">
        <label for="voltage2">Valve 2:</label>
        <input type="range" id="voltage2" name="voltage2" min="0" max="100" step="1" value="0" data-channel="2"><br><br>
        <input type="number" id="voltage2_text" name="voltage2_text" min="0" max="100" step="1" value="0" data-channel="2">
        <input type="submit" value="Set Channel 2">
    </form>

    <a href="/closed2"><button>Close</button></a>
    <a href="/open2"><button>Open</button></a>
    
    <br> <br>
    
    <img src="rpi-gpio.png" alt="Raspberry Pi pins" style="max-width: 700px; Display: Relative;">
</body>
</html>

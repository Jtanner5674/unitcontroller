<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DAC Control</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 20px;
        }

        h1 {
            color: #333;
        }

        .dac-box {
            border: 2px solid #007bff;
            padding: 10px;
            margin-bottom: 20px;
        }

        form {
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 10px;
        }

        input[type="range"] {
            width: 100%;
        }

        button {
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
    </style>
    <script>
        // Function to handle form submissions asynchronously
        function submitForm(event, url) {
            console.log('Form submitted:', url, event);
            event.preventDefault(); // Prevent default form submission behavior
            let formData = new FormData(event.target);
            console.log(formData); // Move this statement here
            fetch(url, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                // Handle the response from the Flask server if needed
                console.log('Form submitted successfully!');
            })
            .catch(error => {
                // Handle any errors that occurred during the fetch
                console.error('Error submitting form:', error);
            });
        }

        function sendPostRequest(url) {
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({}) // Add any payload if required
            })
            .then(response => {
                // Handle the response as needed
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
</head>
<body>
    <h1>DAC Control Interface</h1>

    {% for dac in dac_addresses.dac %}
    {% if dac.found %}
        {% set dac_config = existing_configs.dac | selectattr('id', 'equalto', dac.id) | list | first %}
        <div class="dac-box">
            <h2>{{ dac_config.name or "Unnamed DAC" }}</h2>
            <!-- Form to set voltage for Channel 1 -->
            <form onsubmit="submitForm(event, '/set_voltage{{ dac.id }}')" method="post">
                <label for="voltage_{{ dac.id }}">Enter voltage (0-100%):</label>
                <input type="range" id="voltage_{{ dac.id }}" name="voltage" min="0" max="100" step=".1">
                <button type="submit">Set Voltage for DAC {{ dac.id }}</button>
            </form>
            
            <!-- Open and close the channels -->
            <button onclick="sendPostRequest('/close1{{ dac.id }}')">Close DAC {{ dac.id }}</button>
            <button onclick="sendPostRequest('/open1{{ dac.id }}')">Open DAC {{ dac.id }}</button>
        </div>
    {% endif %}
{% endfor %}
</body>
</html>

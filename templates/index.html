<!DOCTYPE html>
<html>
<head>
    <title>Test DAC Controller</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            function updateSliderValue(channel, value) {
                const slider = document.getElementById(`voltage${channel}`);
                const textInput = document.getElementById(`voltage${channel}_text`);
                slider.value = value;
                textInput.value = value;
            }

            function updateTextInput(channel, value) {
                const slider = document.getElementById(`voltage${channel}`);
                const textInput = document.getElementById(`voltage${channel}_text`);
                textInput.value = value;
                slider.value = value;
            }

            $('input[type="range"]').on('input', function() {
                let channel = $(this).attr('data-channel');
                let value = $(this).val();
                $(`#voltage${channel}_text`).val(value);
            });

            $('input[type="number"]').on('input', function() {
                let channel = $(this).attr('data-channel');
                let value = $(this).val();
                $(`#voltage${channel}`).val(value);
            });
        });
    </script>
</head>
<body>
    <h1>Testing DAC Control Interface</h1>

    {% for dac in found_dacs %}
    <form action="/set_voltage1/{{ dac.address }}" method="post">
        <label for="voltage{{ dac.address }}">Valve {{ dac.address }}:</label>
        <input type="range" id="voltage{{ dac.address }}" name="voltage{{ dac.address }}" min="0" max="100" step="1" value="0" data-channel="{{ dac.address }}"><br><br>
        <input type="number" id="voltage{{ dac.address }}_text" name="voltage{{ dac.address }}_text" min="0" max="100" step="1" value="0" data-channel="{{ dac.address }}">
        <input type="submit" value="Set Channel 1{{ dac.address }}">
    </form>

    <a href="/close1/{{ dac.address }}"><button>Close Channel 0</button></a>
    <a href="/open1/{{ dac.address }}"><button>Open Channel 0</button></a>


    <form action="/set_voltage2/{{ dac.address }}" method="post">
        <label for="voltage{{ dac.address }}">Valve {{ dac.address }}:</label>
        <input type="range" id="voltage{{ dac.address }}" name="voltage{{ dac.address }}" min="0" max="100" step="1" value="0" data-channel="{{ dac.address }}"><br><br>
        <input type="number" id="voltage{{ dac.address }}_text" name="voltage{{ dac.address }}_text" min="0" max="100" step="1" value="0" data-channel="{{ dac.address }}">
        <input type="submit" value="Set Channel 2{{ dac.address }}">
    </form>

    <a href="/close2/{{ dac.address }}"><button>Close Channel 1</button></a>
    <a href="/open2/{{ dac.address }}"><button>Open Channel 1</button></a>
    
    <br><br>
    {% endfor %}

</body>
</html>
